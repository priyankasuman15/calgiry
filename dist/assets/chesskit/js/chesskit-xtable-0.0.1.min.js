"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t(require()):e.ChessKitXtable=t()}(this,function(){return function(){var s,e={},u={inFile:"pgn.pgn",basePath:"./pgn/",targetID:"pgnid"},n=/\[\s*(\w+)\s*"([^"]*)"\s*\]/g,r=/(?:\r\n){2}([^]*(1-0|0-1|1\/2-1\/2|\*)+)(?:\r\n)/g,l=/(^|\r\n)%.*(\r\n|$)/g,c=[],f=new function(e){this.event=e||"?",this.site="?",this.eventdate="?",this.type="op",this.category=1,this.games=0,this.index=[],this.players=0,this.rounds=0,this.xtable=[]};function o(e){this.name=e||"NN",this.draws=0,this.elo=0,this.losses=0,this.ordinal=0,this.played=0,this.score=0,this.tpr=0,this.wins=0,this.colors=[],this.elos=[],this.games=[],this.opponents=[],this.results=[],this.rounds=[],this.row=[],this.rowGames=[],this.scores=[]}function i(e){this.id=e||0,this.headers={},this.escape=[],this.movetext="*",this.pgn=""}function b(e,t){for(var a=e.match(n),r="",s=0;s<a.length;s++)for(;r=n.exec(a[s]);){var l=r[1],o=r[2];c[t].headers[l]=o}}function p(e,t){var a="";a=e.match(r)[0].replace(/^\s\s*/,"").replace(/\s\s*$/,""),c[t].escape=a.match(l),a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(l,"\r\n")).replace(/[\u00A0\u180E\u2000-\u200A\u202F\u205F\u3000]/g," ")).replace(/\u00BD/g,"1/2")).replace(/[\u2010-\u2015]/g,"-")).replace(/\u2024/g,".")).replace(/[\u2025-\u2026]/g,"...")).replace(/\\"/g,"'")).replace(/\r\n/g," ")).replace(/( )+/g," "),c[t].movetext=a}function t(){switch(f.type){case"op":break;case"m":!function(){for(var e=0;e<f.players;e++)for(var t=0;t<f.games;t++)f.xtable[e].row[t]=f.xtable[e].scores[t],f.xtable[e].rowGames[t]=f.xtable[e].games[t];!function(){for(var e=[],t="",a=0;a<f.games;a++)t+="<th>"+([a+1]<10?[a+1]+" ":[a+1]%10)+"</th>";var r,s="<table>";s+="<caption>"+f.eventdate+" "+f.site+" "+f.event+" (Cat."+f.category+")</caption>",s+='<tr><th>##</th><th class="name">PLAYERS</th><th>ELO</th>'+t+"<th>##</th><th>TPR</th></tr>";for(var l=0;l<f.players;l++){for(var o="",n=0;n<f.games;n++){var c=f.xtable[l].rowGames[n];o+='<td class="row xt4web"><span data-game="'+c+'">'+f.xtable[l].row[n].toString().replace(/0.5/g,"=").replace(/_/g," ")+"</span></td>"}var i="<tr>";i+='<td class="ordinal">'+(f.xtable[l].ordinal+1)+"</td>",i+='<td class="name">'+f.xtable[l].name+"</td>",i+='<td class="elo">'+f.xtable[l].elo+"</td>",i+=o,i+='<td class="score">'+f.xtable[l].score+"</td>",i+='<td class="tpr">'+f.xtable[l].tpr+"</td>",i+="</tr>",e.push(i)}for(var b=0;b<f.players;b++)e.sort(m);s+=e.join(""),s+="</table>",(r=document.getElementById(u.targetID))&&(r.innerHTML=s)}()}();break;case"sim":break;case"rr":!function(){for(var a=0;a<f.players;a++){f.xtable[a].row=Array.apply(null,Array(f.players)).map(function(e,t){return f.xtable[a].ordinal==t?"x":"."});for(var e=0;e<f.players;e++)if("."==f.xtable[a].row[e])for(var t=0;t<f.players;t++)if(f.xtable[t].ordinal==e){var r=f.xtable[a].opponents.indexOf(t,0);f.xtable[a].row[e]=f.xtable[a].scores[r]||".",0===f.xtable[a].scores[r]&&(f.xtable[a].row[e]=0),f.xtable[a].rowGames[e]=f.xtable[a].games[r]}}!function(){for(var e=0,t=0,a=[],r="",s=0;s<f.players;s++)e=f.xtable[s].name.length>e?f.xtable[s].name.length:e,t=f.xtable[s].elo>t?f.xtable[s].elo:t,r+="<th>"+([s+1]<10?[s+1]+" ":[s+1]%10)+"</th>";var l,o="<table>";o+="<caption>"+f.eventdate+" "+f.site+" "+f.event+" (Cat."+f.category+")</caption>",o+='<tr><th>##</th><th class="name">PLAYERS</th><th>ELO</th>'+r+"<th>##</th><th>TPR</th></tr>";for(var n=0;n<f.players;n++){for(var c="",i=0;i<f.players;i++){var b=f.xtable[n].rowGames[i];c+='<td class="row xt4web"><span data-game="'+b+'">'+f.xtable[n].row[i].toString().replace(/0.5/g,"=").replace(/_/g," ")+"</span></td>"}var p="<tr>";p+='<td class="ordinal">'+(f.xtable[n].ordinal+1)+"</td>",p+='<td class="name">'+f.xtable[n].name+"</td>",p+='<td class="elo">'+f.xtable[n].elo+"</td>",p+=c,p+='<td class="score">'+f.xtable[n].score+"</td>",p+='<td class="tpr">'+f.xtable[n].tpr+"</td>",p+="</tr>",a.push(p)}for(var x=0;x<f.players;x++)a.sort(m);o+=a.join(""),o+="</table>",(l=document.getElementById(u.targetID))&&(l.innerHTML=o)}()}();break;case"rr2":!function(){for(var e=0;e<f.players;e++){f.xtable[e].row=Array(2*f.players).fill("."),f.xtable[e].row[f.xtable[e].ordinal]="x",f.xtable[e].row[f.xtable[e].ordinal+f.players]="x";for(var t=0;t<f.players;t++)if("."==f.xtable[e].row[t])for(var a=0;a<f.players;a++)if(f.xtable[a].ordinal===t){var r=f.xtable[e].opponents.indexOf(a,0);switch(f.xtable[e].scores[r]){case 1:f.xtable[e].row[t]=1;break;case 0:f.xtable[e].row[t]=0;break;case.5:f.xtable[e].row[t]=.5;break;default:f.xtable[e].row[t]="."}switch(f.xtable[e].rowGames[t]=f.xtable[e].games[r],f.xtable[e].scores[r+f.rounds/2]){case 1:f.xtable[e].row[t+1+f.rounds/2]=1;break;case 0:f.xtable[e].row[t+1+f.rounds/2]=0;break;case.5:f.xtable[e].row[t+1+f.rounds/2]=.5;break;default:f.xtable[e].row[t+1+f.rounds/2]="."}f.xtable[e].rowGames[t+1+f.rounds/2]=f.xtable[e].games[r+f.rounds/2]}}!function(){for(var e=0,t=0,a=[],r="",s=0;s<f.players;s++)e=f.xtable[s].name.length>e?f.xtable[s].name.length:e,t=f.xtable[s].elo>t?f.xtable[s].elo:t,r+="<th>"+([s+1]<10?[s+1]+" ":[s+1]%10)+"</th>";var l,o="<table>";o+="<caption>"+f.eventdate+" "+f.site+" "+f.event+" (Cat."+f.category+")</caption>",o+='<tr><th>##</th><th class="name">PLAYERS</th><th>ELO</th>'+r+"<th>##</th><th>TPR</th></tr>";for(var n=0;n<f.players;n++){for(var c="",i=0;i<f.players;i++){var b=i+f.players,p=f.xtable[n].rowGames[i],x=f.xtable[n].rowGames[b];c+='<td class="row xt4web"><span data-game="'+p+'">'+f.xtable[n].row[i].toString().replace(/0.5/g,"=").replace(/_/g," ")+'</span><span data-game="'+x+'">'+f.xtable[n].row[b].toString().replace(/0.5/g,"=").replace(/_/g," ")+"</span></td>"}var d="<tr>";d+='<td class="ordinal">'+(f.xtable[n].ordinal+1)+"</td>",d+='<td class="name">'+f.xtable[n].name+"</td>",d+='<td class="elo">'+f.xtable[n].elo+"</td>",d+=c,d+='<td class="score">'+f.xtable[n].score+"</td>",d+='<td class="tpr">'+f.xtable[n].tpr+"</td>",d+="</tr>",a.push(d)}for(var h=0;h<f.players;h++)a.sort(m);o+=a.join(""),o+="</table>",(l=document.getElementById(u.targetID))&&(l.innerHTML=o)}()}()}}function x(e,t){var a;switch(e){case"1-0":a="W"==t?"1":"0";break;case"0-1":a="W"==t?"0":"1";break;case"1/2-1/2":a="0.5";break;default:a="*"}return a}function d(e){for(var t=0;t<f.players;t++)if(f.xtable[t].name==e)return t}function h(e,t){return e.score<t.score?1:e.score>t.score?-1:e.tpr<t.tpr?1:e.tpr>t.tpr?-1:0}function m(e,t){var a=/<td class="ordinal">([0-9]{1,3})/,r=e.match(a),s=t.match(a);return parseInt(r[1],10)>parseInt(s[1],10)?1:parseInt(r[1],10)<parseInt(s[1],10)?-1:0}function a(e){!function e(t,a){for(var r in a)a.hasOwnProperty(r)&&(t[r]="object"===_typeof(a[r])?e(t[r],a[r]):a[r]);return t}(u,e)}return e.init=function(e){a(e),s=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}(u.basePath+u.inFile),function(){for(var e='[Event "',t=0;-1!==s.indexOf(e,t);)t=s.indexOf(e,t),f.index.push(t),t+=e.length;f.games=f.index.length;for(var a=0;a<f.games;a++){var r=s.slice(f.index[a],f.index[a+1]);c[a]=new i,c[a].id=a+1,c[a].pgn=r.replace(/^\s\s*/,"").replace(/\s\s*$/,""),b(r,a),p(r,a)}f.event=c[0].headers.Event,f.site=c[0].headers.Site,f.eventdate=c[0].headers.EventDate.slice(0,4)}(),function(){for(var e=[],t=0;t<f.games;t++)e.push(c[t].headers.White),e.push(c[t].headers.Black);e.sort(),e=e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]),f.players=e.length;for(var a=0;a<f.players;a++){var r=new o(e[a]);f.xtable.push(r)}}(),function(){for(var e=0;e<f.players;e++)for(var t=0;t<f.games;t++)switch(f.xtable[e].name){case c[t].headers.White:f.xtable[e].elo=parseInt(c[t].headers.WhiteElo,10);break;case c[t].headers.Black:f.xtable[e].elo=parseInt(c[t].headers.BlackElo,10)}}(),function(){for(var e=0;e<f.players;e++)for(var t=0;t<f.games;t++)switch(f.xtable[e].name){case c[t].headers.White:f.xtable[e].results+=", "+c[t].headers.Result,f.xtable[e].colors+=", W",f.xtable[e].scores+=", "+x(c[t].headers.Result,"W"),f.xtable[e].opponents+=", "+d(c[t].headers.Black),f.xtable[e].games+=", "+t,f.xtable[e].rounds+=", "+c[t].headers.Round,f.xtable[e].elos+=", "+c[t].headers.BlackElo;break;case c[t].headers.Black:f.xtable[e].results+=", "+c[t].headers.Result,f.xtable[e].colors+=", B",f.xtable[e].scores+=", "+x(c[t].headers.Result,"B"),f.xtable[e].opponents+=", "+d(c[t].headers.White),f.xtable[e].games+=", "+t,f.xtable[e].rounds+=", "+c[t].headers.Round,f.xtable[e].elos+=", "+c[t].headers.WhiteElo}for(var a=0;a<f.players;a++)f.xtable[a].results=f.xtable[a].results.split(", "),f.xtable[a].rounds=f.xtable[a].rounds.split(", "),f.xtable[a].colors=f.xtable[a].colors.split(", "),f.xtable[a].scores=f.xtable[a].scores.split(", "),f.xtable[a].opponents=f.xtable[a].opponents.split(", "),f.xtable[a].games=f.xtable[a].games.split(", "),f.xtable[a].elos=f.xtable[a].elos.split(", "),f.xtable[a].results.shift(),f.xtable[a].colors.shift(),f.xtable[a].rounds.shift(),f.xtable[a].rounds=f.xtable[a].rounds.map(function(e){return parseFloat(e,10)}),f.xtable[a].scores.shift(),f.xtable[a].scores=f.xtable[a].scores.map(function(e){return parseFloat(e,10)}),f.xtable[a].opponents.shift(),f.xtable[a].opponents=f.xtable[a].opponents.map(function(e){return parseInt(e,10)}),f.xtable[a].games.shift(),f.xtable[a].games=f.xtable[a].games.map(function(e){return parseInt(e,10)}),f.xtable[a].elos.shift(),f.xtable[a].elos=f.xtable[a].elos.map(function(e){return parseInt(e,10)})}(),function(){f.rounds=2*f.games/f.players,2==f.players&&(f.type="m"),f.players-1==f.games&&(f.type="sim");var e=f.players*(f.players-1)/2,t=f.games/e;e==f.games&&1==t&&(f.type="rr"),2*e==f.games&&2==t&&(f.type="rr2")}(),function(){for(var r=0;r<f.players;r++){f.xtable[r].wins=0,f.xtable[r].losses=0,f.xtable[r].draws=0,f.xtable[r].score=0;for(var e=f.xtable[r].played=0;e<f.xtable[r].scores.length;e++)switch(f.xtable[r].scores[e]){case 1:f.xtable[r].wins++,f.xtable[r].score+=1,f.xtable[r].played++;break;case 0:f.xtable[r].losses++,f.xtable[r].played++;break;case.5:f.xtable[r].draws++,f.xtable[r].score+=.5,f.xtable[r].played++}var t=f.xtable[r].elos.reduce(function(e,t,a){return"*"!==f.xtable[r].results[a]?e+t:e});"rr"!=f.type&&"rr2"!=f.type||(f.xtable[r].tpr=Math.round((t+400*(f.xtable[r].wins-f.xtable[r].losses))/f.xtable[r].played)),"m"==f.type&&(f.xtable[r].tpr=Math.round((t+400*(f.xtable[r].wins-f.xtable[r].losses))/f.games))}}(),function(){for(var e=0,t=0;t<f.players;t++)e+=f.xtable[t].elo;for(var a=Math.round(e/f.players),r=1;r<=25;r++){2226+25*r<=a&&a<=2250+25*r&&(f.category=r)}}(),function(){var e=f.xtable.slice(0);e.sort(h);for(var t=0;t<f.players;t++)for(var a=0;a<e.length;a++)f.xtable[t].name==e[a].name&&(f.xtable[t].ordinal=a)}(),t()},e}});