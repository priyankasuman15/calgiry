"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=n(require()):e.ChessKitUi=n()}(this,function(){return function(){for(var n,u,f,t,w,i,l,k,r,a,o,s,c,p,d,m,g,h,A,v,b,y,M,B,C,L,E,x,T={version:"0.0.1",date:"2017-05-20",url:"http://neven.ca",author:"Knut Neven",email:"neven@neven.ca"},e={},N={gameSelectorOptions:["Select...",!0,0,15,0,15,15,3,10],autoplayDelay:2e3,autoplayNextGame:!1,autostartAutoplay:!1,commentsIntoMoveText:!0,commentsOnSeparateLines:!1,figurinePieceSymbols:!0,highlightOption:!0,pieceFace:"berlin",pieceType:"gradient",pieceSize:"32",imagePath:"./chesskit/piece-sets/",imageType:"png",initialGame:1,initialHalfmove:[0,!1],initialVariation:0,nagUrl:"./chesskit/json/chesskit-nag.json",nagStyle:"chesskit",pgnUrl:"",prefix:"pre1-",sanExtended:!0,shortcutKeysEnabled:!0},I=0,S=1,G=/\[\s*(\w+)\s*"([^"]*)"\s*\]/,O=/\[\s*(\w+)\s*"([^"]*)"\s*\]/g,H=/\s*(\[\s*\w+\s*"[^"]*"\s*\]\s*)+/,P=/\[%pgn_variation (\d+)\]/,K=/\[%pgn_variation (\d+)\]/g,R=/\b((\d+(\.{1,3}|\s)\s*)?((([KQRBN][a-h1-8]?)|[a-h])?x?[a-h][1-8](=[QRNB])?|O-O-O|O-O)\b[!?+#]*)/g,$=/^[\?!+#\s]+(\s|$)/,U=/\[%[^\]]*\]\s*/g,F=/[^a-zA-Z0-9#+=]*/g,_=/[^a-wyzA-WYZ0-9#]*/g,q=!0,D=!1,W="A8",V=new Array,Q=new Array,j=-1,z=-1,X=new Array,Z=new Array,J=new Array,Y=new Array,ee=new Array,ne=new Array,te=new Array,re=new Array,ae=new Array,oe=new Array,ie=new Array,se=new Array,ce=new Array,le=new Array,ue="",fe=!1,pe=null,de=!1,me=-1,ge=0,he=0,ve=0,be=-1,ye=-1,we=-1,ke=-1,Ae=-1,Me=-1,Be=-1,Ce=-1,Le=0,Ee=new Array(8),xe=0;xe<8;++xe)Ee[xe]=new Array(8);var Te=new Array(3),Ne=new Array(3),Ie=new Array(2),Se=new Array(2),Ge=new Array,Oe=new Array(2),He=new Array(2),Pe=new Array(2),Ke=new Array(2);for(xe=0;xe<2;++xe)Oe[xe]=new Array(16),He[xe]=new Array(16),Pe[xe]=new Array(16),Ke[xe]=new Array(16),Se[xe]=new Array,Ie[xe]=new Array;for(xe=0;xe<3;++xe)Te[xe]=new Array,Ne[xe]=new Array;var Re=new Array;Re[0]=!1;var $e=new Array;$e[0]=-1;var Ue=new Array;Ue[0]=0;for(var Fe,_e,qe,De,We,Ve,Qe,je,ze,Xe,Ze,Je,Ye,en,nn,tn,rn,an,on,sn="KQRBNP",cn=sn.split(""),ln="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",un='[Event ""]\n[Site ""]\n[Date ""]\n[Round ""]\n[White ""]\n[Black ""]\n[Result ""]\n',fn=un+"\n{error: click on the top left chessboard square for debug info}",pn="ABCDEFGH",dn=0,mn=new Array(new Array(6),new Array(6)),gn=null,hn=new Array(2),vn=new Array(2),bn=new Array,yn=new Array,wn=!1,kn=" &middot;&middot;&middot;",An=!1,Mn=0,Bn=0,Cn=0,Ln=0,En=15,xn=15,Tn=0,Nn=10,In=-1,Sn=-1,Gn=-1,On=-1,Hn=1e3,Pn=new Array(Hn),Kn=new Array(Hn),Rn=new Array(Hn),$n=0,Un=0,Fn=!1,_n=0,qn=0,Dn=-1,Wn=-1,Vn=null,Qn="",jn=500,zn=3e5,Xn=new Array(8),Zn=new Array(8),Jn=new Array(8),Yn=0;Yn<8;Yn++)Xn[Yn]=new Array(8),Zn[Yn]=new Array(8),Jn[Yn]=new Array(8);function et(e){!function e(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]="object"===_typeof(t[r])?e(n[r],t[r]):t[r]);return n}(N,e)}function nt(e){return JSON.parse(function(e){var n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(null),n.responseText}(e))}function tt(){rt(),h?at(h):document.getElementById("pgnText")?ot("pgnText"):(it(fn),Mr(),ct(),er("error: missing PGN URL location or pgnText in the HTML file",!0))}function rt(){if(gn!==s){0<s.length&&"/"!=s[s.length-1]&&(s+="/"),(Fe=new Image).src=s+"clear."+c;for(var e=new Array("w","b"),n=new Array("k","q","r","b","n","p"),t=0;t<2;++t)for(var r=1;r<7;r++)mn[t][r]=new Image,mn[t][r].src=s+e[t]+n[r-1]+"."+c;gn=s}}function at(n){try{var e=new XMLHttpRequest;e.overrideMimeType&&e.overrideMimeType("text/plain")}catch(e){return er("error: failed creating XMLHttpRequest for PGN URL\n"+n,!0),st(I),!1}var t=qn++;e.onreadystatechange=function(){!function(e,n){var t=I;if(4!=e.readyState)return;{if(n<_n)return;_n=n}200==e.status||304==e.status?304==e.status?er("error: unmodified PGN URL when not in live mode"):e.responseText?!function(e){return it(e)}(e.responseText)?er("error: no games found at PGN URL\n"+h,!0):t=S:er("error: no data received from PGN URL\n"+h,!0):er("error: failed reading PGN URL\n"+h,!0);st(t)}(e,t)};try{e.open("GET",n),e.send(null)}catch(e){return er("error: failed sending XMLHttpRequest for PGN URL\n"+n,!0),!1}return!0}function ot(e){var n,t=I,r=document.getElementById(e);r?("textarea"==r.tagName.toLowerCase()?n=r.value:((n=r.innerHTML).indexOf("\n")<0&&(n=n.replace(/((\[[^\[\]]*\]\s*)+)/g,"\n$1\n")),n.indexOf('"')<0&&(n=n.replace(/(&quot;)/g,'"'))),!1===G.test(n)&&(n=un+"\n"+n),it(n)?t=S:er("error: no games found in "+e+" object in the HTML file")):er("error: missing "+e+" textarea object in the HTML file",!0),st(t)}function it(e){var n,t,r,a,o,i,s,c,l;e=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(function(e){return e=(e=(e=(e=(e=(e=e.replace(/[\u00A0\u180E\u2000-\u200A\u202F\u205F\u3000]/g," ")).replace(/\u00BD/g,"1/2")).replace(/[\u2010-\u2015]/g,"-")).replace(/\u2024/g,".")).replace(/[\u2025-\u2026]/g,"...")).replace(/\\"/g,"'")}(e));var u=/(?:^|\n)%.*(?:\n|$)/gm;u.lastIndex=0;for(var f,p=[];f=u.exec(e);)p.push(f),u.lastIndex==f.index&&u.lastIndex++;for(e=e.replace(/(^|\n)%.*(\n|$)/g,"\n"),n=0,c="";t=H.exec(e);)a=t[0],i=(o=e.indexOf(a))+a.length,r?(l=(s=(c+=e.slice(0,o)).lastIndexOf("{"))<0||c.lastIndexOf("}")>s)?(V[n]=r,Q[n++]=c,c=""):c+=a:l=!0,l&&(r=a),e=e.slice(i);return r&&(V[n]=r,c+=e,Q[n++]=c),0!==n&&(j=n,!0)}function st(e){switch(e){case S:Mr(),ct();break;case I:default:it(fn),Mr(),ct()}}function ct(e){if(void 0!==e){if(!(!isNaN(e)&&0<=e&&e<j))return;z=parseInt(e,10)}fe&&dt(!1),rt(),q&&(function(){var e,n;for(Y.length=ee.length=ne.length=X.length=0,Z.length=J.length=te.length=0,oe.length=ie.length=0,se.length=ce.length=0,le.length=0,re.length=ae.length=0,e=O.lastIndex=0;e<j;++e){var t=V[e];for(Y[e]=ee[e]=ne[e]=X[e]="",Z[e]=J[e]=te[e]="",se[e]=ce[e]="",le[e]="",re[e]=ae[e]="";n=O.exec(t);)switch(n[1]){case"Event":Y[e]=n[2];break;case"Site":ee[e]=n[2];break;case"Round":ne[e]=n[2];break;case"Date":X[e]=n[2];break;case"White":Z[e]=n[2];break;case"Black":J[e]=n[2];break;case"Result":te[e]=n[2];break;case"WhiteElo":re[e]=n[2];break;case"BlackElo":ae[e]=n[2];break;case"SetUp":oe[e]=n[2];break;case"FEN":ie[e]=n[2];break;case"WhiteClock":se[e]=n[2];break;case"BlackClock":ce[e]=n[2];break;case"Variant":le[e]=n[2]}}}(),function(){switch(p){case"first":z=0;break;case"last":z=j-1;break;case"random":z=Math.floor(Math.random()*j);break;default:z=isNaN(parseInt(p,10))?z||0:(p=(p=parseInt(p,10))<0?-Math.floor(-p):Math.floor(p))<-j?0:p<0?j+p:0===p?Math.floor(Math.random()*j):p<=j?p-1:j-1}}()),void 0!==oe[z]&&"1"!=oe[z]?rr():rr(ie[z]),function(e){(function(e){var n,t,r,a,o,i,s,c,l,u,f,p=e;p=p.replace(K,"[%_pgn_variation_ $1]");for(;(u=p.replace(/\((([\?!+#\s]|\$\d+|{[^}]*})*)\)/g," $1 "))!==p;)p=u;for(p=(p=p.replace(/^\s/,"")).replace(/\s$/,""),function(){je=new Array,ze=new Array,Ze=Xe=!1,Je=new Array,Ye=new Array,Wn=-1,Ve=[!1],Qe=0,en=new Array,qe=1,nn=new Array,tn=new Array,Nr(!1)}(),t=qe=0;t<p.length;t++)switch(p.charAt(t)){case" ":case"\b":case"\f":case"\n":case"\r":case"\t":break;case"$":for(c=(s=t)+1;0<="0123456789".indexOf(p.charAt(c))&&!(++c>=p.length););ze[Wn][De+qe]&&(ze[Wn][De+qe]+=" "),ze[Wn][De+qe]+=Ot(p.substring(s,c).replace(/(^\s*|\s*$)/,"")),t=c-1;break;case"!":case"?":for(c=(s=t)+1;0<="!?".indexOf(p.charAt(c))&&!(++c>=p.length););ze[Wn][De+qe]&&(ze[Wn][De+qe]+=" "),ze[Wn][De+qe]+=p.substring(s,c),t=c-1;break;case"{":s=t+1,(c=p.indexOf("}",t+1))<0&&(er("error: missing end comment } in game "+(z+1),!0),c=p.length),ze[Wn][De+qe]&&(ze[Wn][De+qe]+=" "),f=Ot(p.substring(s,c).replace(/(^\s*|\s*$)/,"")),ze[Wn][De+qe]+=f,Xe=Xe||""!==f.replace($,"").replace(/^\s+$/,""),t=c;break;case"%":if(0<t&&"\n"!=p.charAt(t-1))break;s=t+1,(c=p.indexOf("\n",t+1))<0&&(c=p.length),t=c;break;case";":s=t+1,(c=p.indexOf("\n",t+1))<0&&(c=p.length),ze[Wn][De+qe]&&(ze[Wn][De+qe]+=" "),f=Ot(p.substring(s,c).replace(/(^\s*|\s*$)/,"")),ze[Wn][De+qe]+=f,Xe=Xe||""!==f.replace($,"").replace(/^\s+$/,""),t=c;break;case"(":(l="*"==p.charAt(t+1))&&(t+=1),ze[Wn][De+qe]+=" [%pgn_variation "+Qe+"] ",Nr(l);break;case")":Ir();break;default:for(i=new Array("1-0","0-1","1/2-1/2","*"),n=0;n<i.length;n++)if(p.indexOf(i[n],t)==t){0===Wn?r=p.length:(r=t+i[n].length,ze[Wn][De+qe]&&(ze[Wn][De+qe]+=" "),ze[Wn][De+qe]+=i[n]),t=r;break}if(t==p.length)break;if(o=Math.floor((De+qe)/2)+1,i=o.toString(),p.indexOf(i,t)==t)for(t+=i.length;-1!=" .\n\r".indexOf(p.charAt(t));)t++;(r=t+p.substr(t).search(/[\s${;!?()]/))<t&&(r=p.length),a=p.substring(t,r),je[Wn][De+qe]=It(a),Ve[Ve.length-1]=!1,t=" "==p.charAt(r)?r:r-1,je[Wn][De+qe].match(/^[\s+#]*$/)||(qe++,ze[Wn][De+qe]="")}if(0!==Wn)for(er("error: ParsePGNGameString ends with CurrentVar "+Wn+" in game "+(z+1),!0);0<Wn;)Ir();Je[0]=De,Ye[0]=qe,Xe=Xe||Ze,Dn=-1})(Q[e]),z=e,de=!1,Yt()}(z),We=De,q||d[1]?function(){var e;e=m<0?Math.max(Qe+m,0):Math.min(m,Qe-1);switch(d){case"start":vr(Je[e]+(e?1:0),e);break;case"end":vr(Je[e]+Ye[e],e);break;case"random":vr(Je[e]+(e?1:0)+Math.floor(Math.random()*(Je[e]+Ye[e])),e);break;case"comment":case"variation":vr(Je[e]+(e?1:0),e),Et("variation"==d);break;default:isNaN(d=parseInt(d,10))&&(d=0),vr(d<0?Math.max(Je[e]+Ye[e]+1+d,De):Math.min(d,Je[e]+Ye[e]),e)}}():(Tr(),Fr(),wr(),Ht()),q&&t&&dt(!0),$t("ECO",A+"GameECO"),$t("WhiteElo",A+"GameWhiteElo"),$t("BlackElo",A+"GameBlackElo"),$t("Annotator",A+"GameAnnotator"),m=0,q=!1}function lt(e){b=e}function ut(e){w=e}function ft(e){i=e}function pt(e){!function(e){k=e}(e),e?wr():kr(-1,-1,-1,-1)}function dt(e){var n=document.getElementById(A+"ctrlAutoplay"),t=document.getElementById(A+"toolbarAutoplay");fe=e,pe&&(clearTimeout(pe),pe=null),fe?((n||t)&&(n.innerHTML="=",n.value="=",n.title="toggle autoplay (stop)",n.className="autoplayStop",t.innerHTML="=",t.value="=",t.title="toggle autoplay (stop)",t.className="autoplayStop"),We<Je[Wn]+Ye[Wn]?pe=setTimeout(xr,u,1):f&&0===Wn?pe=setTimeout(or,u):dt(!1)):(n||t)&&(n.innerHTML="+",n.value="+",n.title="toggle autoplay (start)",n.className="autoplayStart",t.innerHTML="+",t.value="+",t.title="toggle autoplay (start)",t.className="autoplayStart")}function mt(e){xr(1),function(e){isNaN(e=parseInt(e,10))||(u=Math.min(Math.max(e,jn),zn))}(e),dt(!0)}function gt(){var e=prompt("Enter custom autoplay delay, in seconds, between "+jn/1e3+" and "+zn/1e3+":",Math.floor(u/100)/10);isNaN(e=parseInt(e,10))||mt(1e3*e)}function ht(){fe||xr(1),dt(!fe)}function vt(e,n,t){var r=wn?n:7-n,a=wn?7-e:e,o=document.getElementById(A+"img_tcol"+a+"trow"+r);o&&o.src!=t&&(o.src=t)}function bt(e,n,t,r){var a=document.getElementById(A+"img_tcol"+i+"trow"+s),o=ir(e);if(o){var i=o.col,s=o.row;Zn[i][s]=n,t&&(Xn[i][s]=t),Jn[i][s]=!!r,a&&(wn&&(e=String.fromCharCode(72-i,49+s)),a.title=e+(Zn[i][s]?": "+Zn[i][s]:""))}}function yt(e){e.shiftKey?vr(Je[Wn]+(We<=Je[Wn]+1?0:1)):vr(Je[0],0)}function wt(e){e.shiftKey?vr(Je[Wn]):vr(We-1)}function kt(e){e.shiftKey&&Or()||vr(We+1)}function At(e){e.shiftKey?We===Je[Wn]+Ye[Wn]?Hr():vr(Je[Wn]+Ye[Wn]):vr(Je[0]+Ye[0],0)}function Mt(e){x&&!x.closed&&x.close(),(x=window.open("","chesskitui_fen_data","resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no"))&&(x.document.open("text/html","replace"),e?x.document.write(e):x.document.write("<pre>"+tr()+"</pre>"),x.document.close(),window.focus&&x.focus())}function Bt(e){if(E&&!E.closed&&E.close(),E=window.open("","chesskitui_pgn_data","resizable=yes,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no")){var n="<html><head><title>chesskitui PGN source</title></head><body>\n<pre>\n";if(e)n+=Ct(z)+"\n\n";else for(var t=0;t<j;++t)n+=Ct(t)+"\n\n";n+="\n</pre>\n</body></html>",E.document.open("text/html","replace"),E.document.write(n),E.document.close(),window.focus&&E.focus()}}function Ct(e){var n=V[e]?V[e].replace(/^[^[]*/g,""):"";return n=n.replace(/\[\s*(\w+)\s*"([^"]*)"\s*\][^[]*/g,'[$1 "$2"]\n'),n+="\n",n+=Q[e]?Q[e].replace(/(^[\s]*|[\s]*$)/g,""):""}function Lt(){var e=k;e&&pt(!1),wn=!wn,Yt(),Fr(),e&&pt(!0)}function Et(e){for(var n=We+1;n<=Je[Wn]+Ye[Wn];n++)if(yn[n].match(P)||!e&&Kr(n)){vr(n);break}}function xt(e){for(var n=We-1;De<=n;n--){if((0<n||0<Wn)&&n===Je[Ge[n+1]]){vr(n+1,Ge[n]);break}if(yn[n].match(P)||!e&&Kr(n)){vr(n);break}}}function Tt(){w&&Xe&&(ar("B1")&&bt("B1","find previous comment or variation",function(e,n){xt()},!0),ar("G1")&&bt("G1","find next comment or variation",function(e,n){Et()},!0)),w&&Ze&&(ar("C1")&&bt("C1","go to parent variation",function(e,n){vr(Je[Wn])},!0),ar("F1")&&bt("F1","cycle through alternative variations, if any",function(e,n){Or()||vr(We+1)},!0))}function Nt(e){var n,t,r,a,o;if((e=e||window.event).altKey||e.ctrlKey||e.metaKey)return!0;if(n=e.keyCode,!(b||27==n&&e.shiftKey))return!0;switch(n){case 8:case 9:case 16:case 17:case 18:case 32:case 33:case 34:case 35:case 36:case 92:case 93:case 188:return!0;case 27:e.shiftKey&&Zt();break;case 189:if(o=prompt("Enter shortcut square coordinates to click:",""))for(o=o.toUpperCase().replace(/[^A-Z0-9]/g,"");a=ir(o);)Xn[a.col][a.row]({id:"img_tcol"+a.col+"trow"+a.row},e),o=o.substr(2);break;case 37:wt(e);break;case 38:yt(e);break;case 39:kt(e);break;case 40:At(e);break;case 73:xt(e.shiftKey);break;case 79:Et(e.shiftKey);break;case 190:e.shiftKey?Hr():Or();break;case 85:case 46:Br();break;case 68:e.shiftKey?Mt():Bt(!0);break;case 187:ht();break;case 65:vr(We+1),dt(!0);break;case 48:dt(!1);break;case 49:mt(1e3);break;case 57:gt();break;case 84:h?at(h):document.getElementById("pgnText")?ot("pgnText"):(it(fn),Mr(),ct(),er("error: missing PGN URL location and pgnText object in the HTML file",!0));break;case 70:e.shiftKey&&!wn||Lt();break;case 71:pt(!k);break;case 86:1<j&&ct(0);break;case 66:ct(z-1);break;case 78:ct(z+1);break;case 77:1<j&&ct(j-1);break;case 80:e.shiftKey?ft(!i):ut(!w),t=We,r=Wn,ct(),vr(t,r);break;default:return!0}return function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();return!1}(e)}function It(e){var n=v?F:_;return(e=e.replace(n,"")).match(/^[Oo0]/)&&(e=e.replace(/[o0]/g,"O").replace(/O(?=O)/g,"O-")),e=e.replace(/ep/i,"")}function St(e){return e.id===this}function Gt(e,n){$=/^([\?!+#\s]|<span class="nag">[^<]*<.span>)+(\s|$)/;var t=y.filter(St,e);return"chesskit"===n?t[0].javascript||t[0].csm:t[0].csm||t[0].description}function Ot(e){var n="chesskit"===g?'<span class="nag">':"",t="chesskit"===g?"</span>":"",r=e.match(/\$+[0-9]+/g);if(r)for(var a=0;a<r.length;a++){var o=r[a].substr(1);""!==Gt(o,g)&&(e=e.replace(new RegExp("\\$+"+o+"(?!\\d)"),n+Gt(o,g)+t))}return e}function Ht(){!function(e){var n=tr(),t={kings:0,queens:0,rooks:0,bishops:0,knights:0,pawns:0},r=0;for(;" "!=n.charAt(r);){switch(n.charAt(r)){case"K":t.kings++;break;case"k":t.kings--;break;case"Q":t.queens++;break;case"q":t.queens--;break;case"R":t.rooks++;break;case"r":t.rooks--;break;case"B":t.bishops++;break;case"b":t.bishops--;break;case"N":t.knights++;break;case"n":t.knights--;break;case"P":t.pawns++;break;case"p":t.pawns--}r++}var a="";if(a+=Kt("Q",t.queens),a+=Kt("R",t.rooks),a+=Kt("B",t.bishops),a+=Kt("N",t.knights),a=function(e){for(var n="",t=0;t<e.length;t++){var r=e[t]==e[t].toUpperCase()?"w":"b";n+='<img id="" class="-material" src="'+s+r+e[t].toLowerCase()+"."+c+'"/>'}return n}(a=function(e){var n="";return n+=Rt("P",e.split("P").length-1),n+=Rt("N",e.split("N").length-1),n+=Rt("B",e.split("B").length-1),n+=Rt("R",e.split("R").length-1),n+=Rt("Q",e.split("Q").length-1),n+=Rt("q",e.split("q").length-1),n+=Rt("r",e.split("r").length-1),n+=Rt("b",e.split("b").length-1),n+=Rt("n",e.split("n").length-1),n+=Rt("p",e.split("p").length-1)}(a+=Kt("P",t.pawns))),e){var o=document.getElementById(e);o&&"string"==typeof o.innerHTML&&(o.innerHTML=a)}}(A+"GameMaterial"),Pt(Ut("csl",A+"csl",We,Wn),"csl",We,Wn),Pt(Ut("cal",A+"cal",We,Wn),"cal",We,Wn),Pt(Ut("clk",A+"clk",We,Wn),"clk",We,Wn)}function Pt(e,n,t,r){var a=A+"v"+r+"m"+t;if(a){var o=document.getElementById(a);o&&"string"==typeof o.innerHTML&&""!==e&&function(e,n){console.dir(e+" "+n)}(n,o.dataset[n]=e)}}function Kt(e,n){var t=Math.abs(n),r="";if(0!==t)for(var a=0;a<t;a++)r+=0<n?e:e.toLowerCase();return r}function Rt(e,n){for(var t="",r=0;r<n;r++)t+=e;return t}function $t(e,n,t){var r,a="";if(e=e.replace(/\W+/g,""),void 0===t&&(t=z),V[t]&&(r=V[t].match("\\[\\s*"+e+'\\s*"([^"]+)"\\s*\\]'))&&(a=r[1]),n){var o=document.getElementById(n);o&&"string"==typeof o.innerHTML&&(o.innerHTML=a)}return a}function Ut(e,n,t,r){var a,o="",i=document.getElementById(n);return e=e.replace(/\W+/g,""),void 0===r&&(r=0),void 0===t&&(t=We),ze[r][t]&&(a=ze[r][t].match("\\[%"+e+'\\s+((?:,?(?:"[^"]*"|[^,\\]]*))*)\\s*\\]'))&&(o=a[1].replace(/\s+$/,"")),n&&i&&"string"==typeof i.innerHTML&&(i.innerHTML=o),o}function Ft(e){!0===(D=b)&&lt(!1)}function _t(e){!0===D&&lt(!0),D=!1}function qt(e){!function(e){ct(parseInt(e.target.value,10)),e.target.value=-1}(e)}function Dt(e){!function(e){ct(parseInt(e.target.attributes["data-game"].value,10))}(e)}function Wt(e){!function(e){!function(e,n){switch(e.id){case A+"toolbarStart":yt(n);break;case A+"toolbarBack":wt(n);break;case A+"toolbarAutoplay":n.altKey&&gt(),n.shiftKey?Or():ht();break;case A+"toolbarForward":kt(n);break;case A+"toolbarEnd":At(n);break;case A+"toolbarFlipBoard":Lt();break;case A+"toolbarSetHighlight":pt(!k);break;case A+"toolbarUndo":Br();break;case A+"toolbarShortcutKeys":Zt();break;case A+"toolbarComments":n.shiftKey?ft(!i):ut(!w);var t=We,r=Wn;ct(),vr(t,r);break;case A+"toolbarLoadFirst":1<j&&ct(0);break;case A+"toolbarLoadPrevious":1<j&&ct(z-1);break;case A+"toolbarLoadNext":1<j&&ct(z+1);break;case A+"toolbarLoadLast":1<j&&ct(j-1);break;case A+"toolbarCommentPrevious":xt();break;case A+"toolbarCommentNext":Et();break;case A+"toolbarVariationParent":vr(Je[Wn]);break;case A+"toolbarVariationAlternate":Or()||vr(We+1)}}(e.target,e)}(e)}function Vt(e){!function(e){!function(e,n){switch(e.id){case A+"ctrlStart":yt(n);break;case A+"ctrlBack":wt(n);break;case A+"ctrlAutoplay":n.altKey&&gt(),n.shiftKey?Or():ht();break;case A+"ctrlForward":kt(n);break;case A+"ctrlEnd":At(n)}}(e.target,e)}(e)}function Qt(e){!function(e){var n=/img_tcol([0-7]{1})trow([0-7]{1})$/.exec(e.target.id);if(null!=n){var t=parseInt(n[1],10),r=parseInt(n[2],10);Xn[t][r](this,e),function(e,n){if(Vn)return;var t=A+"tcol"+n+"trow"+e,r=document.getElementById(t);if(r){var a=r.className;r.className=(e+n)%2==0?"-bs":"-ws",Vn=setTimeout(jt,66,e,n,a,r.className),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty&&document.selection.empty()}}(r,t)}}(e)}function jt(e,n,t,r){var a=document.getElementById(A+"tcol"+n+"trow"+e);a&&(a.className==r&&(a.className=t),Vn=null)}function zt(e){!function(e){e.stopPropagation(),e.preventDefault();var n=/v([0-9]{1,4})m([0-9]{1,4})$/.exec(e.target.id);if(null!=n){var t=parseInt(n[1],10);vr(parseInt(n[2],10),t)}}(e)}function Xt(e){Nt(e)}function Zt(){confirm("Shortcut keys currently "+(b?"enabled":"disabled")+".\nToggle shortcut keys to "+(b?"DISABLED":"ENABLED")+"?")&&lt(!b)}function Jt(e){tt()}function Yt(){var e,n,t,r,a,o,i,s,c;if(r=document.getElementById(A+"GameBoard")){for(t='<table id="'+A+'boardTable" class="ck-diagram__table">',e=0;e<8;++e){for(t+="<tr>",n=0;n<8;++n)o=A+"img_"+(a="tcol"+n+"trow"+e),t+=(e+n)%2==0?'<td class="-ws" id="'+A+a+'"':'<td class="-bs" id="'+A+a+'"',t+=' align="center" valign="middle">',i=wn?String.fromCharCode(72-n,49+e):String.fromCharCode(n+65,56-e),""!==Zn[n][e]&&(i+=": "+Zn[n][e]),t+='<img src="'+Fe.src+'" class="-figurine"id="'+o+'" title="'+i+'" /></td>';t+="</tr>"}t+="</table>",r.innerHTML=t}if((r=document.getElementById(A+"ToolBar"))&&(t='<span id="'+A+'toolbarStart">&lt;&lt;</span>',t+='<span id="'+A+'toolbarBack">&lt;</span>',t+='<span id="'+A+'toolbarAutoplay" '+(fe?'class="autoplayStop">':'class="autoplayStart">')+(fe?"=":"+")+"</span>",t+='<span id="'+A+'toolbarForward">&gt;</span>',t+='<span id="'+A+'toolbarEnd">&gt;&gt;</span>',t+='<span id="'+A+'toolbarFlipBoard">flip</span>',t+='<span id="'+A+'toolbarSetHighlight">HL</span>',t+='<span id="'+A+'toolbarUndo">U</span>',t+='<span id="'+A+'toolbarShortcutKeys">SCKs</span>',t+='<span id="'+A+'toolbarComments">CV</span>',1<j&&(t+='<span id="'+A+'toolbarLoadFirst">&lt;&lt;</span>',t+='<span id="'+A+'toolbarLoadPrevious">&lt;</span>',t+='<span id="'+A+'toolbarLoadNext">&gt;</span>',t+='<span id="'+A+'toolbarLoadLast">&gt;&gt;</span>'),w&&Xe&&(t+='<span id="'+A+'toolbarCommentPrevious">cP</span>',t+='<span id="'+A+'toolbarCommentNext">cN</span>'),w&&Ze&&(t+='<span id="'+A+'toolbarVariationParent">vP</span>',t+='<span id="'+A+'toolbarVariationAlternate">vA</span>'),r.innerHTML=t),(r=document.getElementById(A+"GameInfo"))&&(t='<span id="'+A+'infoLastMove" class="info-last-move"></span>',t+='<span id="'+A+'infoSideToMove" class="info-stm"></span>',t+='<span id="'+A+'infoNextMove" class="info-next-move"></span>',r.innerHTML=t),(r=document.getElementById(A+"GameControls"))&&(t='<span id="'+A+'ctrlStart">&lt;&lt;</span>',t+='<span id="'+A+'ctrlBack">&lt;</span>',t+='<span id="'+A+'ctrlAutoplay" '+(fe?'class="autoplayStop">':'class="autoplayStart">')+(fe?"=":"+")+"</span>",t+='<span id="'+A+'ctrlForward">&gt;</span>',t+='<span id="'+A+'ctrlEnd">&gt;&gt;</span>',r.innerHTML=t),r=document.getElementById(A+"GameSelector"))if(q&&(Qn=""),j<2){for(;r.firstChild;)r.removeChild(r.firstChild);Qn=""}else if(""===Qn){An&&(Mn=Math.floor(Math.log(j)/Math.log(10))+1),t='<form id="'+A+'GameForm"> <select id="'+A+'GameFormSelect"',t+=' class="ck-selector-control" title="Select a Game..."><option value="-1">';var l="";for(e=0;e<32;e++)l+=" ";for(t+=((An?l.substring(0,Mn)+"  ":"")+kn).replace(/ /g,"&nbsp;"),e=0;e<j;e++)Qn+='<option value="'+e+'">',c="",An&&(s=" "+(e+1),c+=l.substr(0,Mn-(s.length-1))+s+" "),0<Bn&&(c+=" "+Y[e].substring(0,Bn)+l.substr(0,Bn-Y[e].length)+" "),0<Cn&&(c+=" "+ee[e].substring(0,Cn)+l.substr(0,Cn-ee[e].length)+" "),0<Ln&&(c+=" "+l.substr(0,Ln-ne[e].length)+ne[e].substring(0,Ln)+" "),0<En&&(c+=" "+Z[e].substring(0,En)+l.substr(0,En-Z[e].length)+" "),0<xn&&(c+=" "+J[e].substring(0,xn)+l.substr(0,xn-J[e].length)+" "),0<Tn&&(c+=" "+te[e].substring(0,Tn)+l.substr(0,Tn-te[e].length)+" "),0<Nn&&(c+=" "+X[e].substring(0,Nn)+l.substr(0,Nn-X[e].length)+" "),Qn+=c.replace(/ /g,"&nbsp;");t+=Qn.replace(/&(amp|lt|gt);/g,"&amp;$1;")+"</select></form>",r.innerHTML=t}(r=document.getElementById(A+"GameEvent"))&&(r.innerHTML=Y[z]),(r=document.getElementById(A+"GameRound"))&&(r.innerHTML=ne[z]),(r=document.getElementById(A+"GameSite"))&&(r.innerHTML=ee[z]),(r=document.getElementById(A+"GameDate"))&&(r.innerHTML=X[z],r.style.whiteSpace="nowrap"),(r=document.getElementById(A+"GameWhite"))&&(r.innerHTML=Z[z]),(r=document.getElementById(A+"GameBlack"))&&(r.innerHTML=J[z]),(r=document.getElementById(A+"GameResult"))&&(r.innerHTML=te[z],r.style.whiteSpace="nowrap"),(r=document.getElementById(A+"GameText"))&&(rn=-1,t='<span id="'+A+'PgnText">'+Rr(0)+"</span>",t+=' <span class="result">'+te[z]+"</span>",r.innerHTML=t),Tt()}function er(e,n){C++,0,n&&L++,B=(B+1)%M.length,M[B]=e+"\n"+(new Date).toLocaleString(),ar(W)&&bt(W,"chesskitui v"+T.version+" debug info\n"+C+" alert"+(1<C?"s":""),null,!0),function(e){console.log(e)}(e)}function nr(e,n){er("error: invalid FEN in game "+(z+1)+": "+n+"\n"+e,!0)}function tr(){for(var e="",n=0,t=7;0<=t;t--){for(var r=0;r<=7;r++)0===Ee[r][t]?n++:(n&&(e+=n,n=0),0<Ee[r][t]?e+=sn.charAt(Ee[r][t]-1).toUpperCase():Ee[r][t]<0&&(e+=sn.charAt(-Ee[r][t]-1).toLowerCase()));n&&(e+=n,n=0),0<t&&(e+="/")}e+=We%2?" b":" w";var a="";null!==mr(0)&&(a+=sn.charAt(0).toUpperCase()),null!==gr(0)&&(a+=sn.charAt(1).toUpperCase()),null!==mr(1)&&(a+=sn.charAt(0).toLowerCase()),null!==gr(1)&&(a+=sn.charAt(1).toLowerCase()),e+=" "+(a||"-"),Re[We]?(e+=" "+String.fromCharCode($e[We]+97),e+=We%2?"3":"6"):e+=" -";for(var o=dn,i=De;i<We;i++)6==Se[0][i]||16<=Ie[1][i]?o=0:o++;return e+=" "+o,e+=" "+(Math.floor(We/2)+1)}function rr(e){var n,t,r,a,o,i,s="string"!=typeof e?ln:e.replace(/\\/g,"/").replace(/[^a-zA-Z0-9\s\/-]/g," ").replace(/(^\s*|\s*$)/g,"").replace(/\s+/g," ");for(n=0;n<8;++n)for(t=0;t<8;++t)Ee[n][t]=0;_e=(De=0)%2;var c,l=!1;if(hn=[0,0],vn=[7,7],dn=0,Ge[De]=0,Ue[De]=0,s==ln)for(a=0;a<2;a++)for(Pe[a]=[1,2,5,5,4,4,3,3,6,6,6,6,6,6,6,6],Oe[a]=[4,3,1,6,2,5,0,7,0,1,2,3,4,5,6,7],Ke[a]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],He[a]=a?[7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6]:[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],n=0;n<16;n++){var u=Oe[a][n],f=He[a][n];Ee[u][f]=(1-2*a)*Pe[a][n]}else{var p,d,m,g;for(n=0;n<2;n++)for(t=0;t<16;t++)Pe[n][t]=-1,Oe[n][t]=0,He[n][t]=0,Ke[n][t]=0;for(t=7,d=n=0,g=m=1,r=s.charAt(d++);" "!=r;){if("/"==r){if(8!=n)return nr(s,"char "+d),void rr();n=0,t--}if(8==n)return nr(s,"char "+d),void rr();if(!isNaN(r)&&((n+=parseInt(r,10))<0||8<n))return nr(s,"char "+d),void rr();if(r.charCodeAt(0)==sn.toUpperCase().charCodeAt(0)){if(-1!=Pe[0][0])return nr(s,"char "+d),void rr();Pe[0][0]=1,Oe[0][0]=n,He[0][0]=t,n++}if(r.charCodeAt(0)==sn.toLowerCase().charCodeAt(0)){if(-1!=Pe[1][0])return nr(s,"char "+d),void rr();Pe[1][0]=1,Oe[1][0]=n,He[1][0]=t,n++}for(p=1;p<6;p++){if(r.charCodeAt(0)==sn.toUpperCase().charCodeAt(p)){if(16==m)return nr(s,"char "+d),void rr();Pe[0][m]=p+1,Oe[0][m]=n,He[0][m]=t,m++,n++}if(r.charCodeAt(0)==sn.toLowerCase().charCodeAt(p)){if(16==g)return nr(s,"char "+d),void rr();Pe[1][g]=p+1,Oe[1][g]=n,He[1][g]=t,g++,n++}}r=d<s.length?s.charAt(d++):" "}if(8!=n||0!==t)return nr(s,"char "+d),void rr();if(-1==Pe[0][0]||-1==Pe[1][0])return nr(s,"missing King"),void rr();for(d==s.length&&(s+="w "+Cr()+" - 0 1"),"w"==(r=s.charAt(d++))||"b"==r?"b"==r&&(De+=1,_e=1):nr(s,"invalid active color"),a=0;a<2;++a)for(n=0;n<16;n++)-1!=Pe[a][n]&&(u=Oe[a][n],f=He[a][n],Ee[u][f]=(1-2*a)*Pe[a][n]);for(++d>=s.length&&(nr(s,"missing castling availability"),s+=" "+Cr()+" - 0 1",d++),hn=[-1,-1],vn=[-1,-1],r=s.charAt(d++);" "!=r;){if(r.charCodeAt(0)==sn.toUpperCase().charCodeAt(0)){for(vn[0]=7;vn[0]>Oe[0][0]&&3!=Ee[vn[0]][0];vn[0]--);vn[0]<=Oe[0][0]&&(nr(s,"missing castling Rook "+r),vn[0]=-1)}if(r.charCodeAt(0)==sn.toUpperCase().charCodeAt(1)){for(hn[0]=0;hn[0]<Oe[0][0]&&3!=Ee[hn[0]][0];hn[0]++);hn[0]>=Oe[0][0]&&(nr(s,"missing castling Rook "+r),hn[0]=-1)}if(r.charCodeAt(0)==sn.toLowerCase().charCodeAt(0)){for(vn[1]=7;vn[1]>Oe[1][0]&&-3!=Ee[vn[1]][7];vn[1]--);vn[1]<=Oe[1][0]&&(nr(s,"missing castling Rook "+r),vn[1]=-1)}if(r.charCodeAt(0)==sn.toLowerCase().charCodeAt(1)){for(hn[1]=0;hn[1]<Oe[1][0]&&-3!=Ee[hn[1]][7];hn[1]++);hn[1]>=Oe[1][0]&&(nr(s,"missing castling Rook "+r),hn[1]=-1)}0<=(o=pn.toUpperCase().indexOf(r))?a=0:0<=(o=pn.toLowerCase().indexOf(r))&&(a=1),0<=o&&(Ee[o][7*a]==3*(1-2*a)?(o>Oe[a][0]&&(vn[a]=o),o<Oe[a][0]&&(hn[a]=o)):nr(s,"missing castling Rook "+r)),r=d<s.length?s.charAt(d++):" "}for(d>=s.length&&(nr(s,"missing en passant square"),s+=" - 0 1",d++),r=s.charAt(d++);" "!=r;)0<=r.charCodeAt(0)-97&&r.charCodeAt(0)-97<=7&&(l=!0,c=r.charCodeAt(0)-97),r=d<s.length?s.charAt(d++):" ";for(d>=s.length&&(nr(s,"missing halfmove clock"),s+=" 0 1",d++),dn=0,r=s.charAt(d++);" "!=r;){if(isNaN(r)){nr(s,"invalid halfmove clock");break}dn=10*dn+parseInt(r,10),r=d<s.length?s.charAt(d++):" "}for(d>=s.length&&(nr(s,"missing fullmove number"),s+=" 1",d++),i=0,r=s.charAt(d++);" "!=r;){if(isNaN(r)){nr(s,"invalid fullmove number"),i=1;break}i=10*i+parseInt(r,10),r=d<s.length?s.charAt(d++):" "}0===i&&(nr(s,"invalid fullmove 0 set to 1"),i=1),Re[De+=2*(i-1)]=l,$e[De]=c,Ue[De]=0,Ge[De]=0}}function ar(e){var n=ir(e);return!!n&&Jn[n.col][n.row]}function or(){0===L&&0<j&&(ct((z+1)%j),1<j||0<qe)?dt(!0):dt(!1)}function ir(e){if("string"!=typeof e||!e)return null;var n=e.charCodeAt(0)-65;if(n<0||7<n)return null;var t=56-e.charCodeAt(1);return t<0||7<t?null:{col:n,row:t}}function sr(e,n){var t,r;if("--"==e)return _r(n),!0;if("O-O"==e){if(!function(){var e=mr(_e);if(null===e)return!1;Ee[Oe[_e][0]][7*_e]=0,Ee[Oe[_e][e]][7*_e]=0;var n=Oe[_e][e];n<6&&(n=6);for(;n>Oe[_e][0]||5<=n;){if(0!==Ee[n][7*_e])return!1;--n}return me=e,!0}())return!1;for(r=Oe[_e][0];r<7;r++)if(Lr(r,7*_e,_e))return!1;return _r(n),!0}if("O-O-O"==e){if(!function(){var e=gr(_e);if(null===e)return!1;Ee[Oe[_e][0]][7*_e]=0,Ee[Oe[_e][e]][7*_e]=0;var n=Oe[_e][e];2<n&&(n=2);for(;n<Oe[_e][0]||n<=3;){if(0!==Ee[n][7*_e])return!1;++n}return me=e,!0}())return!1;for(r=Oe[_e][0];1<r;r--)if(Lr(r,7*_e,_e))return!1;return _r(n),!0}if(!ge&&0!==Ee[we][ke])return!1;if(ge&&function(e){if(e<0)return 1;if(0<e)return 0;return 2}(Ee[we][ke])!=1-_e&&(6!=Ae||!Re[n]||$e[n]!=we||ke!=5-3*_e))return!1;if(ve){if(6!=Ae)return!1;if(6<=Be)return!1;if(ke!=7*(1-_e))return!1}for(var a=0;a<16;++a)if(Pe[_e][a]==Ae&&(1==Ae?t=cr(a):2==Ae?t=lr(a):3==Ae?t=ur(a):4==Ae?t=fr(a):5==Ae?t=pr(a):6==Ae&&(t=dr(a)),t)){if(Me=a,_r(n),!Lr(Oe[_e][0],He[_e][0],_e))return!0;qr(n)}return!1}function cr(e){return!(0<=be&&be!=Oe[_e][e])&&(!(0<=ye&&ye!=He[_e][e])&&(!(1<Math.abs(Oe[_e][e]-we))&&!(1<Math.abs(He[_e][e]-ke))))}function lr(e){return!(0<=be&&be!=Oe[_e][e])&&(!(0<=ye&&ye!=He[_e][e])&&(((Oe[_e][e]-we)*(He[_e][e]-ke)==0||Math.abs(Oe[_e][e]-we)==Math.abs(He[_e][e]-ke))&&!!hr(e)))}function ur(e){return!(0<=be&&be!=Oe[_e][e])&&(!(0<=ye&&ye!=He[_e][e])&&((Oe[_e][e]-we)*(He[_e][e]-ke)==0&&!!hr(e)))}function fr(e){return!(0<=be&&be!=Oe[_e][e])&&(!(0<=ye&&ye!=He[_e][e])&&(Math.abs(Oe[_e][e]-we)==Math.abs(He[_e][e]-ke)&&!!hr(e)))}function pr(e){return!(0<=be&&be!=Oe[_e][e])&&(!(0<=ye&&ye!=He[_e][e])&&Math.abs(Oe[_e][e]-we)*Math.abs(He[_e][e]-ke)==2)}function dr(e){if(0<=be&&be!=Oe[_e][e])return!1;if(0<=ye&&ye!=He[_e][e])return!1;if(Math.abs(Oe[_e][e]-we)!=ge)return!1;if(ge){if(He[_e][e]-ke!=2*_e-1)return!1}else if(He[_e][e]-ke==4*_e-2){if(He[_e][e]!=1+5*_e)return!1;if(0!==Ee[we][ke+2*_e-1])return!1}else if(He[_e][e]-ke!=2*_e-1)return!1;return!0}function mr(e){if(vn[e]<0)return null;if(0<Ke[e][0])return null;for(var n=!1,t=0;t<16;t++)if(Oe[e][t]==vn[e]&&Oe[e][t]>Oe[e][0]&&He[e][t]==7*e&&3==Pe[e][t]){n=!0;break}return n?0<Ke[e][t]?null:t:null}function gr(e){if(hn[e]<0)return null;if(0<Ke[e][0])return null;for(var n=!1,t=0;t<16;t++)if(Oe[e][t]==hn[e]&&Oe[e][t]<Oe[e][0]&&He[e][t]==7*e&&3==Pe[e][t]){n=!0;break}return n?0<Ke[e][t]?null:t:null}function hr(e){for(var n=Dr(we-Oe[_e][e]),t=Dr(ke-He[_e][e]),r=Oe[_e][e]+n,a=He[_e][e]+t;r!=we||a!=ke;){if(0!==Ee[r][a])return!1;r+=n,a+=t}return!0}function vr(e,n){if(dt(!1),void 0===n?n=Wn:n<0?n=0:Qe<=n&&(n=Qe-1),e<0?e=0:e>=Je[n]+Ye[n]&&(e=Je[n]+Ye[n]),n===Wn){var t=e-We;0<t?xr(t):Er(-t)}else{var r=De;e:for(var a=tn[Wn].length-1;0<=a;a--)for(var o=tn[n].length-1;0<=o;o--)if(tn[Wn][a]===tn[n][o]){r=Math.min(tn[Wn][a+1]?Je[tn[Wn][a+1]]:We,tn[n][o+1]?Je[tn[n][o+1]]:e);break e}Er(We-r,!0),xr(e-r,n)}}function br(e){return Ut("clk",null,e)}function yr(e){var n=($t("Clock")+"").match("^"+(e?"W":"B")+"/(.*)$");return n?n[1]:null}function wr(){var e,n,t,r,a,o,i;!function(){if(Fn)return;$n!==Un&&z===Pn[Un]&&Wn===Kn[Un]&&We===Rn[Un]||(Pn[Un=(Un+1)%Hn]=z,Kn[Un]=Wn,Rn[Un]=We,$n===Un&&($n=($n+1)%Hn))}(),ue&&(e=document.getElementById(ue))&&(e.className=(ue.match(/v0m/)?"move":"variation")+" notranslate");var s=We-1;s>Je[Wn]+Ye[Wn]&&(s=Je[Wn]+Ye[Wn]),(e=document.getElementById(A+"GameLastComment"))&&(t=w?(rn=0===Wn?0:1,'<span class="comment">'+Kr(s+1,Wn,!0).replace(/\sid="[^"]*"/g,"")+"</span>"):"",e.innerHTML=t);var c=(s+1)%2==0,l=c?"info-stm-w":"info-stm-b";(e=document.getElementById(A+"infoSideToMove"))&&(e.classList.remove("info-stm-w","info-stm-b"),e.classList.add(l));var u,f,p,d,m=document.getElementById(A+c?"GameBlackClock":"GameWhiteClock"),g=c?ce[z]:se[z],h=document.getElementById(A+c?"GameWhiteClock":"GameBlackClock"),v=c?se[z]:ce[z];if(m&&(null===(a=s+1===De+qe&&"*"!==te[z]?yr(!c):null)&&((a=De<s+1?br(s+1):g)||We!==De+qe||(o=new RegExp((c?"Black":"White")+"\\s+Time:\\s*(\\S+)","i"),(i=Kr(De+qe).match(o))&&(a=i[1]))),m.innerHTML=a),h&&(null===(a=s+1===De+qe&&"*"!==te[z]?yr(c):null)&&((a=De<s?br(s):v)||We!==De+qe||(o=new RegExp((c?"White":"Black")+"\\s+Time:\\s*(\\S+)","i"),(i=Kr(De+qe).match(o))&&(a=i[1]))),h.innerHTML=a),m&&h&&(m.innerHTML&&!h.innerHTML?h.innerHTML="-":!m.innerHTML&&h.innerHTML&&(m.innerHTML="-")),(e=document.getElementById(A+"infoNextMove"))&&(t=0===Wn&&De+qe<=s+1?'<span class="move notranslate">'+te[z]+"</span>":void 0===bn[s+1]?"":$r(s+1,Wn,0!==Wn,!0,!1),e.innerHTML=t),e=document.getElementById(A+"GameNextVariations")){if(t="",w){var b=Sr(s+1,Wn);for(r=0;r<b.length;r++)b[r]!==Wn&&(t+=" "+$r(s+1,b[r],0!==b[r],!0,!1))}e.innerHTML=t}if((e=document.getElementById(A+"infoLastMove"))&&(t=De<=s&&bn[s]?$r(s,Wn,0!==Wn,!0,!1):s===De-1?'<span class="move notranslate">'+(Math.floor((s+1)/2)+1)+((s+1)%2?"...":".")+"</span>":"",e.innerHTML=t),e=document.getElementById(A+"GameLastVariations")){if(t="",w){var y=Sr(s,Ge[s]);for(r=0;r<y.length;r++)y[r]!==Wn&&(t+=" "+$r(s,y[r],0!==y[r],!0,!1))}e.innerHTML=t}s>=Je[Wn]-1&&(n=A+"v"+Wn+"m"+(s+1),(e=document.getElementById(n))&&(e.className=(Wn?"variation variationOn":"move moveOn")+" notranslate"),ue=n,k&&(s<De||Ue[s]?(u=f=-1,p=d=-1):(u=void 0===Te[0][s]?-1:Te[0][s],f=void 0===Ne[0][s]?-1:Ne[0][s],p=void 0===Te[2][s]?-1:Te[2][s],d=void 0===Ne[2][s]?-1:Ne[2][s]),kr(u,f,p,d)))}function kr(e,n,t,r){Ar(In,Sn,!1),Ar(Gn,On,!1),Ar(e,n,!0)?(In=e,Sn=n):In=Sn=-1,Ar(t,r,!0)?(Gn=t,On=r):Gn=On=-1}function Ar(e,n,t){if(void 0===e||void 0===n)return!1;if(!Wr(e,n))return!1;var r=wn?n:7-n,a=wn?7-e:e,o=document.getElementById(A+"tcol"+a+"trow"+r);return!!o&&(o.className=t?(r+a)%2==0?"-wsh":"-bsh":(r+a)%2==0?"-ws":"-bs",!0)}function Mr(){Pn=new Array(Hn),Kn=new Array(Hn),Rn=new Array(Hn),$n=Un=0}function Br(){return(Un-1+Hn)%Hn!==$n&&(Fn=!0,Pn[Un=(Un-1+Hn)%Hn]!==z&&ct(Pn[Un]),vr(Rn[Un],Kn[Un]),!(Fn=!1))}function Cr(){var e,n="";if(0===He[0][0]&&4===Oe[0][0])for(e=0;e<Pe[0].length;e++)3===Pe[0][e]&&0===He[0][e]&&7===Oe[0][e]&&(n+=sn.charAt(0).toUpperCase()),3===Pe[0][e]&&0===He[0][e]&&0===Oe[0][e]&&(n+=sn.charAt(1).toUpperCase());if(7===He[1][0]&&4===Oe[1][0])for(e=0;e<Pe[1].length;e++)3===Pe[1][e]&&7===He[1][e]&&7===Oe[1][e]&&(n+=sn.charAt(0).toLowerCase()),3===Pe[1][e]&&7===He[1][e]&&0===Oe[1][e]&&(n+=sn.charAt(1).toLowerCase());return n||"-"}function Lr(e,n,t){var r,a,o=2*t-1;if(Math.abs(Oe[1-t][0]-e)<=1&&Math.abs(He[1-t][0]-n)<=1)return!0;for(r=-2;r<=2;r+=4)for(a=-1;a<=1;a+=2){if(Wr(e+r,n+a)&&Ee[e+r][n+a]==5*o)return!0;if(Wr(e+a,n+r)&&Ee[e+a][n+r]==5*o)return!0}for(r=-1;r<=1;r+=2)if(Wr(e+r,n-o)&&Ee[e+r][n-o]==6*o)return!0;for(r=-1;r<=1;++r)for(a=-1;a<=1;++a)if(0!==r||0!==a)for(var i=e+r,s=n+a,c=0;Wr(i,s)&&0===c;)if(0===(c=Ee[i][s]))i+=r,s+=a;else{if(c==2*o)return!0;if(c==3*o&&(0===r||0===a))return!0;if(c==4*o&&0!==r&&0!==a)return!0}return!1}function Er(e,n){var t=We-1,r=t-e;r<De&&(r=De-1);for(var a=t;r<a;--a)We--,_e=1-_e,Wn=Ge[a],qr(a);n||(Tr(),Fr(),wr(),pe&&(clearTimeout(pe),pe=null),fe&&(r>=Je[Wn]?pe=setTimeout(Er,u,1):dt(!1)),Ht())}function xr(e,n,t){var r,a,o,i=-1;void 0===n&&(n=Wn);var s=We+parseInt(e,10);s>Je[n]+Ye[n]&&(s=Je[n]+Ye[n]);for(var c=We;c<s;++c){if(n!==Wn){for(var l=0;l<tn[n].length&&tn[n][l]!==Wn;l++);if(l===tn[n].length)return void er("error: unknown path to variation "+n+" from "+Wn+" in game "+(z+1),!0);for(a=Je[tn[n][l+1]],l+=1;l<tn[n].length-1&&Je[tn[n][l+1]]===Je[tn[n][l]];l++);r=tn[n][l]}else r=a=-1;if(c===a&&(i=Wn,Wn=r),void 0===(o=je[Wn][c]))break;if(de=!Pr(o,c)){er("error: invalid ply "+(Math.floor(c/2)+1+(c%2==0?". ":"... "))+o+" in game "+(z+1)+" variation "+Wn,!0),c===a&&(Wn=i);break}_e=1-_e}We=c,t||(Tr(),Fr(),wr(),pe&&(clearTimeout(pe),pe=null),de?dt(!1):c==s&&fe&&(s<Je[Wn]+Ye[Wn]?pe=setTimeout(xr,u,1):f&&0===Wn?pe=setTimeout(or,u):dt(!1)),Ht())}function Tr(){var e,n;if(Wn!==Dn){bn=new Array,yn=new Array;for(var t=0;t<tn[Wn].length;t++){e=Je[tn[Wn][t]],n=t<tn[Wn].length-1?Je[tn[Wn][t+1]]:Je[tn[Wn][t]]+Ye[tn[Wn][t]];for(var r=e;r<n;r++)bn[r]=je[tn[Wn][t]][r],yn[r]=ze[tn[Wn][t]][r]||""}yn[r]=ze[tn[Wn][t-1]][r]||"",qe=Je[Wn]+Ye[Wn]-De,Dn=Wn}}function Nr(e){0<=Wn&&(en.push(Wn),nn.push(qe)),Wn=Qe++,tn[Wn]=en.slice(0),tn[Wn].push(Wn),je[Wn]=new Array,ze[Wn]=new Array,e||(Ve[Ve.length-1]?er("warning: malformed PGN data in game "+(z+1)+": variation "+Wn+" starting before parent",!0):qe-=1),Ve.push(!0),ze[Wn][De+qe]="",Je[Wn]=De+qe}function Ir(){De+qe===Je[Wn]?er("warning: empty variation "+Wn+" in game "+(z+1),!1):Ze=!0,Ve.pop(),Ye[Wn]=De+qe-Je[Wn];for(var e=Je[Wn];e<=Je[Wn]+Ye[Wn];e++)ze[Wn][e]?(ze[Wn][e]=ze[Wn][e].replace(/\s+/g," "),ze[Wn][e]=Ot(ze[Wn][e]),ze[Wn][e]=ze[Wn][e].replace(/\s+$/g,"")):ze[Wn][e]="";en.length?(Wn=en.pop(),qe=nn.pop()):er("error: closeVar error in game "+(z+1),!0)}function Sr(e,n){void 0===n&&(n=Wn),void 0===e&&(e=We);for(var t=new Array,r=n;r<Qe;r++)(r===n&&Je[r]+Ye[r]>e||Gr(r)===n&&Je[r]===e&&0<Ye[r])&&t.push(r);return t}function Gr(e){for(var n=tn[e].length-1;0<n;n--)if(Je[tn[e][n]]!==Je[tn[e][n-1]])return tn[e][n-1];return tn[e][n]}function Or(){if(We===De)return!1;var e=Sr(We-1,Ge[We-1]);if(e.length<2)return!1;for(var n=0;n<e.length&&e[n]!==Wn;n++);return e[n]===Wn&&(vr(We,e[(n+1)%e.length]),!0)}function Hr(){var e=Sr(We,Wn);if(e.length<1)return!1;if(e[0]===Wn){if(e.length<2)return!1;vr(We+1,e[1])}else vr(We+1,e[0]);return!0}function Pr(e,n){var t,r,a,o=-1;if(Ce=Be=Me=Ae=ke=we=ye=be=me=-1,void(Le=ge=ve=he=0)===e)return!1;if(Re[n+1]=!1,$e[n+1]=-1,0===e.indexOf("--"))return Le=1,sr("--",n),!0;for(t=e.length-1;0<t;t--)if(!isNaN(e.charAt(t))){we=e.charCodeAt(t-1)-97,ke=e.charAt(t)-1,a=e.substring(0,t-1),o=t;break}if(we<0||7<we||ke<0||7<ke)return 0===e.indexOf("O-O-O")?(Me=0,Be=Ae=he=1,be=4,we=2,ke=ye=7*_e,sr("O-O-O",n)):0===e.indexOf("O-O")&&(Me=0,Be=Ae=he=1,be=4,we=6,ke=ye=7*_e,sr("O-O",n));if(4<(r=(a=a.replace(/-/g,"")).length))return!1;if(Ae=-1,0===r)Ae=6;else{for(t=5;0<t;t--)if(a.charAt(0)==cn[t-1]){Ae=t;break}if(-1==Ae&&0<=pn.toLowerCase().indexOf(a.charAt(0))&&(Ae=6),-1==Ae)return!1;if("x"==a.charAt(r-1)&&(ge=1),isNaN(e.charAt(r-1-ge))?((be=e.charCodeAt(r-1-ge)-97)<0||7<be)&&(be=-1):(ye=e.charAt(r-1-ge)-1)<0||7<ye?ye=-1:((be=e.charCodeAt(r-2-ge)-97)<0||7<be)&&(be=-1),1<r&&!ge&&-1==be&&-1==ye)return!1;if(6==Ae&&!ge&&-1==be&&-1==ye)return!1}if(Be=Ae,(0!==Ee[we][ke]||6==Ae&&Re[n]&&we==$e[n]&&ke==5-3*_e)&&(ge=1),6==Ae){if((t=e.indexOf("="))<0&&(t=o),0<t&&t<e.length-1){var i=e.charAt(t+1);i==cn[1]?Be=2:i==cn[2]?Be=3:i==cn[3]?Be=4:i==cn[4]&&(Be=5),Be!=Ae&&(ve=1)}if(ke==7*(1-_e)?!ve:ve)return!1}if(ge){for(Ce=15;0<=Ce;Ce--)if(0<Pe[1-_e][Ce]&&Oe[1-_e][Ce]==we&&He[1-_e][Ce]==ke){if(1==Pe[1-_e][Ce])return!1;break}if(6==Ae&&Ce<1&&Re[n])for(Ce=15;0<=Ce;Ce--)if(6==Pe[1-_e][Ce]&&Oe[1-_e][Ce]==we&&He[1-_e][Ce]==4-_e){Pe[1-_e][Ce];break}}return!!sr(cn[Ae-1],n)&&(6==Ae&&2==Math.abs(Ne[0][n]-ke)&&(Re[n+1]=!0,$e[n+1]=we),!0)}function Kr(e,n,t){return void 0===t&&(t=!1,void 0===n&&(n=Wn)),ze[n][e]?function(e){if(l)return e.replace(R,function(e){return Ur(e)});return e.replace(R,'<span class="commentMove">$1</span>')}(ze[n][e]).replace(K,function(e){return function(e,n){void 0===n&&(n=!1);var t=e.replace(P,"$1");if(isNaN(t))return er("error: issue parsing variation tag "+e+" in game "+(z+1),!0),"";var r=Rr(t);r?n&&(r="</span>"+r+'<span class="comment">'):r="";return r}(e,t)}).replace(U,"").replace(e===Je[n]?"":$,"").replace(/^\s+$/,""):""}function Rr(e){var n;if(isNaN(e)||e<0||Qe<=e||void 0===Je[e]||void 0===Ye[e])return er("error: issue parsing variation id "+e+" in game "+(z+1),!0),"";var t=++rn?'<span class="variation">'+(on?" ":"")+(1<rn?"(":"[")+"</span>":"";on=!1;for(var r=Je[e];r<Je[e]+Ye[e];r++)an=!1,w&&(n=Kr(r,e,!0))&&(i&&0===rn&&r>Je[e]&&(t+='<div class="comment">&nbsp;</div>'),on?-1==",.;:!?".indexOf(n.charAt(0))&&(t+='<span class="variation"> </span>'):on=0<rn,t+='<span class="comment">'+n+"</span>",i&&0===rn&&(t+='<div class="comment">&nbsp;</div>'),an=!0),(an||on)&&(t+='<span class="variation"> </span>'),on=!0,t+=$r(r,e,0<rn,an||r==Je[e],!0);return w&&(n=Kr(Je[e]+Ye[e],e,!0))&&(i&&0===rn&&(t+='<div class="comment">&nbsp;</div>'),on&&-1==",.;:!?".indexOf(n.charAt(0))&&(t+='<span class="comment notranslate"> </span>'),t+='<span class="comment">'+n+"</span>",an=!0),t+=rn--?'<span class="variation">'+(rn?")":"]")+"</span>":"",on=!0,t}function $r(e,n,t,r,a){void 0===n&&(n=Wn),void 0===e&&(e=We);var o="";if(Qe<=n||e<Je[n]||e>Je[n]+Ye[n])return o;var i=Math.floor(e/2)+1;e%2==0?o+='<span class="'+(t?"variation":"move")+' notranslate">'+i+".&nbsp;</span>":r&&(o+='<span class="'+(t?"variation":"move")+' notranslate">'+i+"...&nbsp;</span>");var s=e+1,c=je[n][e];return l&&(c=Ur(je[n][e])),o+='<a href="#" class="'+(t?"variation":"move")+' notranslate" '+(a?'id="'+A+"v"+n+"m"+s+'">':">")+c,w&&(o+=function(e,n){if(void 0===n&&(n=Wn),!ze[n][e])return"";var t=ze[n][e].replace(U,"").match($,"");return t?t[0].replace(/\s+(?!class=)/gi,""):""}(s,n)),o+="</A>"}function Ur(e){var n='<span class="figurine"></span>',t='<span class="figurine"></span>',r='<span class="figurine"></span>',a='<span class="figurine"></span>',o='<span class="figurine"></span>',i=e.match(/([KQRBN]+)/g),s="";switch(i=i?i.toString():""){case"K":s=n;break;case"Q":s=t;break;case"R":s=r;break;case"B":s=a;break;case"N":s=o}return e.replace(i,s)}function Fr(){for(var e=0;e<8;++e)for(var n=0;n<8;++n)0===Ee[e][n]&&vt(e,n,Fe.src);for(e=0;e<2;++e)for(n=0;n<16;++n)0<Pe[e][n]&&vt(Oe[e][n],He[e][n],mn[e][Pe[e][n]].src)}function _r(e){Ge[e+1]=Wn,(Ue[e]=Le)||(Ie[0][e]=Me,Te[0][e]=Oe[_e][Me],Ne[0][e]=He[_e][Me],Se[0][e]=Pe[_e][Me],Te[2][e]=we,Ne[2][e]=ke,he?(Ie[1][e]=me,Te[1][e]=Oe[_e][me],Ne[1][e]=He[_e][me],Se[1][e]=Pe[_e][me]):0<=Ce?(Ie[1][e]=Ce+16,Te[1][e]=Oe[1-_e][Ce],Ne[1][e]=He[1-_e][Ce],Se[1][e]=Pe[1-_e][Ce]):Ie[1][e]=-1,(Ee[Oe[_e][Me]][He[_e][Me]]=0)<=Ce&&(Pe[1-_e][Ce]=-1,Ke[1-_e][Ce]++,Ee[Oe[1-_e][Ce]][He[1-_e][Ce]]=0),Pe[_e][Me]=Be,Ke[_e][Me]++,Oe[_e][Me]=we,He[_e][Me]=ke,he&&(Ke[_e][me]++,Oe[_e][me]=2==we?3:5,He[_e][me]=ke),Ee[we][ke]=Pe[_e][Me]*(1-2*_e),he&&(Ee[Oe[_e][me]][He[_e][me]]=Pe[_e][me]*(1-2*_e)))}function qr(e){if(!Ue[e]){var n=Ie[0][e];Ee[Oe[_e][n]][He[_e][n]]=0,Ee[Te[0][e]][Ne[0][e]]=Se[0][e]*(1-2*_e),Pe[_e][n]=Se[0][e],Oe[_e][n]=Te[0][e],He[_e][n]=Ne[0][e],Ke[_e][n]--,0<=(n=Ie[1][e])&&n<16&&(Ee[Oe[_e][n]][He[_e][n]]=0,Ee[Te[1][e]][Ne[1][e]]=Se[1][e]*(1-2*_e),Pe[_e][n]=Se[1][e],Oe[_e][n]=Te[1][e],He[_e][n]=Ne[1][e],Ke[_e][n]--),0<=(n-=16)&&n<16&&(Ee[Oe[1-_e][n]][He[1-_e][n]]=0,Ee[Te[1][e]][Ne[1][e]]=Se[1][e]*(2*_e-1),Pe[1-_e][n]=Se[1][e],Oe[1-_e][n]=Te[1][e],He[1-_e][n]=Ne[1][e],Ke[1-_e][n]--)}}function Dr(e){return 0<e?1:e<0?-1:0}function Wr(e,n){return 0<=e&&e<=7&&0<=n&&n<=7}function Vr(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent("on"+n,t)}return e.init=function(e){et(e),n=N.gameSelectorOptions,u=N.autoplayDelay,f=N.autoplayNextGame,t=N.autostartAutoplay,w=N.commentsIntoMoveText,i=N.commentsOnSeparateLines,l=N.figurinePieceSymbols,k=N.highlightOption,r=N.pieceFace,a=N.pieceType,o=N.pieceSize,s=N.imagePath,c=N.imageType,p=N.initialGame,d=N.initialHalfmove,m=N.initialVariation,g=N.nagStyle,h=N.pgnUrl,A=N.prefix,v=N.sanExtended,b=N.shortcutKeysEnabled,y=nt(N.nagUrl),function(e){var n=e[0],t=e[1],r=e[2],a=e[3],o=e[4],i=e[5],s=e[6],c=e[7],l=e[8];"string"==typeof n&&(kn=n),An=!0===t,Bn=Math.max(Math.min(r,32)||0,0)||0,Cn=Math.max(Math.min(a,32)||0,0)||0,Ln=Math.max(Math.min(o,32)||0,0)||0,En=Math.max(Math.min(i,32)||0,0)||0,xn=Math.max(Math.min(s,32)||0,0)||0,Tn=Math.max(Math.min(c,32)||0,0)||0,Nn=Math.max(Math.min(l,32)||0,0)||0}(n),function(e){s=e+r+"/"+c+"/"+a+"/"+o+"/","svg"===c&&(s=e+r+"/"+c+"/"+a+"/512/")}(s),Vr(window,"load",Jt),Vr(document,"keydown",Xt),Vr(document.getElementById(A+"ToolBar"),"click",Wt),Vr(document.getElementById(A+"GameBoard"),"click",Qt),Vr(document.getElementById(A+"GameControls"),"click",Vt),Vr(document.getElementById(A+"GameText"),"click",zt),document.getElementById(A.slice(0,-1))&&Vr(document.getElementById(A.slice(0,-1)),"click",Dt),document.getElementById(A+"GameSelector")&&(Vr(document.getElementById(A+"GameSelector"),"focus",Ft),Vr(document.getElementById(A+"GameSelector"),"change",qt),Vr(document.getElementById(A+"GameSelector"),"blur",_t)),function(e,n){if("string"==typeof e&&"string"==typeof n)for(var t=0;t<e.length;t++)for(var r=0;r<n.length;r++)bt(e.charAt(t).toUpperCase()+n.charAt(r),"",function(e,n){})}("ABCDEFGH","12345678"),bt("B8","show current position FEN string",function(e,n){Mt()},!0),bt("C8","show current game PGN source data",function(e,n){Bt(!0)},!0),bt("D8","show all games PGN source data",function(e,n){Bt()},!0),bt("B7","undo last chessboard position update",function(e,n){Br()},!0),bt("D7","toggle highlight last move",function(e,n){pt(!k)},!0),bt("E7","flip board",function(e,n){n.shiftKey&&!wn||Lt()},!0),bt("F7","toggle show comments in game text",function(e,n){n.shiftKey?ft(!i):ut(!w);var t=We,r=Wn;ct(),vr(t,r)},!0),bt("H7","toggle enabling shortcut keys",function(e,n){Zt()},!0),bt("A3","load first game",function(e,n){1<j&&ct(0)},!0),bt("C3","load previous game",function(e,n){1<j&&ct(z-1)},!0),bt("F3","load next game",function(e,n){1<j&&ct(z+1)},!0),bt("H3","load last game",function(e,n){1<j&&ct(j-1)},!0),bt("A2","stop autoplay",function(e,n){dt(n.shiftKey)},!0),bt("B2","toggle autoplay",function(e,n){ht()},!0),bt("D2","autoplay 1 second",function(e,n){mt(1e3*(n.shiftKey?10:1))},!0),bt("E2","autoplay custom delay",function(e,n){gt()},!0),bt("A1","go to game start",function(e,n){yt(n)},!0),bt("B1","",function(e,n){},!0),bt("C1","",function(e,n){},!0),bt("D1","move backward",function(e,n){wt(n)},!0),bt("E1","move forward",function(e,n){kt(n)},!0),bt("F1","",function(e,n){},!0),bt("G1","",function(e,n){},!0),bt("H1","go to game end",function(e,n){At(n)},!0),Tt()},{chesskitui:e,init:e.init}}});
